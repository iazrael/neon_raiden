# 游戏数值与系统设计规范 (Game Design Document)

**版本**: v1.5 (Final)  
**更新日期**: 2025年11月29日  
**适用范围**: 生产环境配置与数值参考  
**状态**: 已整合 P0(平衡调整) / P1(优化) / P2(进阶) / P3(实验性) 所有功能

---

## 1. 玩家基础配置 (Player Profile)

| 属性 | 基础数值 | 上限/规则 | 说明 |
| :--- | :--- | :--- | :--- |
| **生命值 (HP)** | 120 | 140 (基础上限) | 可通过道具恢复，超出上限无效 |
| **护盾值 (Shield)** | 70 | 动态上限 | 基础70，随连击数提升(+25/+50/+75)，上限动态调整 |
| **移动速度** | 7 | - | 单位：像素/帧 |
| **炸弹储量** | 3 | 9 | 全屏清弹/高伤 |
| **武器槽位** | - | 5 | 最多同时装备5种不同武器 |
| **武器等级** | 1 | 9 | 单个武器最高等级 |


## 战机升级机制（新增）

**触发规则**

- 升级依据总得分，需求得分按倍数增长：`scoreRequired(n) = base * growth^(n-1)`，默认 `base=10000`、`growth=2`。
- 最高等级：`maxLevel=20`，超过不再升级。

**每级加成（默认）**

- `maxHp +20`、`maxShield +10`、`defense +1%`、`fireRate +1%`、`damage +1%`（三项百分比加成总上限各为15%）。
- 升级后立即回满生命与护盾。

**表现**

- 升级时机体闪烁，播放升级音效。
- UI：机体上方显示战机等级；武器等级显示在左上角武器名字旁。
- 图鉴：显示最高等级与该等级下的最终属性（HP/护盾/防御/射速/伤害）。

**平衡建议**

- 若中后期升级过慢，可将 `growth` 调为 `1.75` 或提高 `base` 初期奖励。
- 若DPS提升过快，可下调 `fireRate/damage` 叠加幅度或设上限。

---

## 2. 武器系统 (Weapon System)

### 2.x 等级上限与 HUD 展示规范（P0）
* 武器等级上限：玩家武器最高等级为 **9**（由 `PowerupEffects.maxWeaponLevel` 控制）。
* Boss 武器等级上限：配置新增 `maxLevel` 字段（默认 **9**），用于限定数值边界与展示，不改变当前战斗逻辑。
* HUD 展示：左上角显示 `Capitalize(武器名) Lv.{weaponLevel}`；机体上方 `LV.{playerLevel}` 表示战机等级（基于得分升级的玩家等级，详见“玩家等级系统”），与连击系统独立。
* 玩家武器具体等级上限：`VULCAN/LASER/MISSILE/TESLA/MAGMA/SHURIKEN = 6`；`WAVE/PLASMA = 3`。

### 2.1 武器属性总表
> **注意**: VULCAN、LASER、PLASMA 的基础伤害已应用 P0 级平衡调整。

| ID | 中文名 | 基础伤害 | 成长/级 | 射速(ms) | 射速成长 | 弹速 | 特性描述 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **VULCAN** | 散弹枪 | **12** | +3 | 150 | +2 | 15 | 扇形覆盖，每级子弹数+1 (P1平滑) |
| **LASER** | 激光炮 | **6** | +2 | 180 | +2 | 25 | 穿透，每3级增加光束数 (P1平滑) |
| **MISSILE** | 追踪导弹 | 30 | +3 | 350 | +10 | 15 | 自动追踪最近目标 |
| **WAVE** | 波动炮 | 18 | +6 | 400 | +20 | 12 | 宽幅穿透，无视体积 |
| **PLASMA** | 等离子炮 | **45** | +12 | 600 | +20 | 8 | 极高单发，爆炸范围伤害 |
| **TESLA** | 电磁炮 | 15 | +4 | 200 | +10 | 25 | 命中后连锁攻击附近敌人 |
| **MAGMA** | 熔岩弹 | 12 | +2 | 200 | +0 | 12 | 附加持续灼烧伤害 |
| **SHURIKEN** | 手里剑 | 14 | +3 | 300 | +30 | 12 | 碰到屏幕边缘或敌人时反弹 |

### 2.2 武器升级曲线
*   **VULCAN (线性成长)**: 子弹数量序列: 1 → 2 → 3 → 4 → 5 → 6 → 7 → 8 → 9
*   **LASER (阶梯成长)**: 光束数量序列: 1 → 1 → 1 → **2** → 2 → 2 → **3** → 3 → 3
*   **其他武器**: 保持原文档定义的标准线性数值成长。

### 2.3 武器组合技 (Synergy System)
当玩家同时持有以下武器对时，自动触发被动/改造效果；不需要双弹并发。

#### 2.3.1 合成弹与轮发模式
- **合成弹模式（默认）**：主武器子弹被动改造成“合成弹”，附加副武器特性与效果；仅保持单一弹型。
- **轮发模式（可选）**：主/副武器在每次射击间 ABAB 切换，仍保持同一时刻仅一种弹型。

#### 2.3.2 协同效果总表（初始数值）
| 主武器 | 副武器 | 组合技名称 | 效果详情 |
| :--- | :--- | :--- | :--- |
| LASER | TESLA | **电磁折射** | 激光命中时 **15%** 概率触发连锁电弧（额外2跳）。 |
| WAVE | PLASMA | **能量共鸣** | 命中在路径上生成微型涡流区（1.2s，半径≈80），处于该区的波段伤害 **×1.5**。 |
| MISSILE | VULCAN | **弹幕覆盖** | 合成弹爆炸释放短程碎片（8枚×15%伤害），主炸伤害 **×1.2**。 |
| MAGMA | SHURIKEN | **熔火飞刃** | 手里剑每次反弹为命中目标叠 `灼烧`（5/秒×3s），≥2次反弹效率 **+50%**。 |
| TESLA | PLASMA | **等离子风暴** | 等离子爆炸额外触发 **3道** 闪电，并为玩家 `护盾+6`、`无敌200ms`（5s CD）。 |
| WAVE | MISSILE | **减速场** | 导弹爆炸生成 **1.8s** 减速场（敌弹速度-25%、敌人移动-20%）。 |
| SHURIKEN | LASER | **反弹护身** | 每次反弹为玩家提供 **0.6s** 移速+10%。 |

数值上限与难度适配：
- 10s窗口内护盾/生命回复不超过 `maxShield` 的 **30%** 与 `maxHp` 的 **15%**。
- HARD 模式下协同触发率 **-10%**、回复类效果 **-15%**。

---

## 3. 战斗核心机制 (Combat Mechanics)

### 3.1 连击系统 (Combo System)
*   **机制**: 击杀敌人增加计数，5秒未击杀重置。
*   **奖励阶梯**:
    *   **10 Hit**: 伤害 x1.2 / 得分 x1.5
    *   **25 Hit**: 伤害 x1.5 / 得分 x2.0 / 护盾上限+25
    *   **50 Hit**: 伤害 x2.0 / 得分 x3.0 / 护盾上限+50 (累计)
*   **100 Hit (狂暴)**: 伤害 **x3.0** / 得分 **x5.0** / 护盾上限+75 (累计)

### 3.3 炸弹（BOMB）
- 伤害：`600`（全屏清弹并造成高额伤害）。

### 3.2 动态难度系统 (Dynamic Difficulty)
系统每15秒评估一次玩家表现（基于HP剩余、武器等级、连击数），自动调整全局参数。

| 难度状态 | 触发条件 | 敌人生成间隔 | 敌人血量/速度 | 精英概率 | 道具/得分 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **EASY** | 评分连续过低 | 90% (-10%) | 85% / 90% | +10% | 120% |
| **NORMAL** | 标准状态 | 100% | 100% | 0% | 100% |
| **HARD** | 评分连续过高 | 115% (+15%) | 120% / 110% | -5% | 80% / 110% |

---

## 4. 敌人配置 (Enemy Bestiary)

### 4.1 普通敌人属性

| ID | 类型 | 基础HP | 基础速度 | 击杀分 | 行为特征 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **NORMAL** | 无人机 | 30 | 2.0 | 100 | 基础散弹 |
| **FAST** | 紫色飞翼 | 10 | 10.0 | 200 | 快速冲锋 |
| **TANK** | 重型坦克 | 60 | 1.0 | 300 | 高血量肉盾 |
| **KAMIKAZE** | 自爆机 | 5 | 10.0 | 400 | 锁定玩家撞击 |
| **ELITE_GUNBOAT** | 炮舰 | 100 | 0.5 | 500 | 慢速高伤 |
| **LASER_INTERCEPTOR**| 拦截机 | 80 | 4.0 | 600 | 蓄力激光 |
| **MINE_LAYER** | 布雷机 | 60 | 1.5 | 700 | 放置滞留机雷 |
| **PULSAR** | 脉冲机 | 15 | 6.0 | 250 | 高频弹幕 |
| **FORTRESS** | 堡垒 | 200 | 0.8 | 800 | 移动缓慢，全向弹幕 |
| **STALKER** | 追踪机 | 30 | 5.0 | 350 | 发射追踪弹 |
| **BARRAGE** | 弹幕机 | 100 | 1.2 | 600 | 螺旋弹幕覆盖 |

### 4.2 精英敌人系统 (Elite System)
*   **生成概率**: 基础 10% (受动态难度修正)。
*   **基础加成**: HP x3, 伤害 x1.5, 尺寸 x1.3, 得分 x3。
*   **射速加成**: x1.5。
*   **敌人数量倍率**: x1.15。
*   **AI行为强化 (P3新增)**:
    *   **TANK (护卫)**: 额外召唤2个普通敌人伴飞护卫。
    *   **FAST (轨迹)**: 移动路径留下滞留伤害的能量轨迹。
    *   **KAMIKAZE (狂暴)**: 血量<30%时速度x1.5并体型变大。
    *   **LASER_INTERCEPTOR (快充)**: 激光蓄力时间减半，频率加倍。
    *   **FORTRESS (重力)**: 发射重力球，减缓玩家移动与子弹速度。

---

## 5. Boss配置与机制 (Boss Design)

### 5.1 Boss 总表 (整合P0数值与P3移动模式)

| 关卡 | ID | 称号 | HP (P0修正) | 弹幕密度/帧 | 推荐移动模式 (P3) | 特殊机制 (P1/P2) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | **GUARDIAN** | 守护者 | 2000 | 0.48 | SINE (正弦) | 护盾再生(每20s回复500HP) |
| 2 | **INTERCEPTOR**| 拦截者 | 3200 | 0.80 | ZIGZAG (之字形) | 闪现突袭(每15s瞬移+扇形弹) |
| 3 | **DESTROYER** | 毁灭者 | 5000 | 0.96 | FIGURE_8 (八字轨迹) | **三阶段装甲** (见5.2) |
| 4 | **ANNIHILATOR**| 歼灭者 | 6000 | 0.90 | TELEPORT (随机瞬移) | - |
| 5 | **DOMINATOR** | 主宰者 | 7000 | 1.26 | CIRCLE (环形绕场) | - |
| 6 | **OVERLORD** | 霸主 | 8800 | 1.26 | TRACKING (持续追踪) | 连续激光 |
| 7 | **TITAN** | 泰坦 | 10500 | 1.30 | SLOW_DESCENT (缓降压迫) | **三阶段过载** (见5.2) |
| 8 | **COLOSSUS** | 巨像 | 9000 | 1.40 | AGGRESSIVE (激进) | 脉冲激光 + 1僚机 |
| 9 | **LEVIATHAN** | 利维坦 | 10000 | 1.76 | AGGRESSIVE (激进) | 2僚机 |
| 10 | **APOCALYPSE** | 天启 | 12000 | 2.34 | ADAPTIVE (自适应)| **四阶段终焉** (见5.2) |

### 5.x 生成时机配置
- `minLevelDuration=50`、`minLevelProgress=100`。

### 5.2 Boss 阶段系统 (Phase System)
部分Boss根据血量百分比进入不同阶段，属性发生倍率变化：

*   **Lv3 DESTROYER (毁灭者)**
    *   100%-70%: 正常。
    *   70%-35%: 弹幕x1.2，射速x1.4。
    *   35%-0%: **核心暴露** - 弹幕x1.5，伤害x1.5。

*   **Lv7 TITAN (泰坦)**
    *   100%-65%: 正常。
    *   65%-30%: 射速x1.5 (激光威胁提升)。
    *   30%-0%: **最终防线** - 弹幕x1.8，射速x2.0。

*   **Lv10 APOCALYPSE (天启)**
    *   100%-75%: 正常。
    *   75%-50%: 弹幕x1.3。
    *   50%-25%: 狂暴，射速x2.0。
    *   25%-0%: **绝境** - 全属性 x2.0，射速 x2.5 (弹幕地狱)。

---

## 6. 关卡环境机制 (Level Environment)

除敌人外，关卡本身包含的环境挑战：

*   **第 3 关**: **物理障碍物** - 屏幕中部出现可摧毁掩体（HP 200），阻挡双方子弹。
*   **第 5 关**: **能量风暴** - 每20秒出现横向能量带，进入其中的玩家减速30%。
*   **第 7 关**: **陨石雨** - 随机坠落陨石，造成20伤害，可击碎得分。
*   **第 9 关**: **重力场** - 左右交替的强引力场，强制改变玩家位移。

---

## 7. 经济与掉落 (Economy)

*   **普通敌人**: 10% 概率掉落。
*   **精英敌人**: 60% 概率掉落。
*   **Boss**: 100% 掉落 (固定3个道具)。
*   **掉落池权重**:
    *   15: POWER (通用伤害提升)
    *   18: HP (回血)
    *   10 (各): VULCAN / LASER / MISSILE (基础武器)
    *   8 (各): SHURIKEN / TESLA / MAGMA (进阶武器)
    *   4: WAVE
    *   2: PLASMA (稀有)
    *   10: BOMB (炸弹)
    *   2: OPTION (僚机)
    *   10: INVINCIBILITY (无敌时间，原TEMP_SHIELD)
    *   10: TIME_SLOW (时间减缓)

*   **道具效果数值**:
    *   武器等级上限（道具层级控制）: 9
    *   僚机数量上限: 3
    *   炸弹数量上限（通过道具获取）: 6
    *   HP 恢复: 30
    *   护盾恢复: 25

*   **掉落算法优化**:
    *   采用别名方法(Alias Method)实现O(1)时间复杂度的道具选择
    *   使用权重系统替代概率系统，避免手动维护概率总和为1的问题
    *   所有道具被选中的机会均等，解决原来后面道具难以掉落的问题
