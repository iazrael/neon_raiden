---
trigger: always_on
---

# 核心代码质量规则：高内聚、低耦合、零冗余

每次你新增、修改或重构代码时，必须严格遵守以下原则（优先级最高）：

1. 高内聚（High Cohesion）
   - 一个文件/类/函数只做一件事，并且把所有相关的逻辑都集中在同一个模块里。
   - 如果一个模块同时处理了明显不相关的职责（例如既处理业务逻辑又处理文件读写又处理 UI 展示），必须立即拆分。

2. 低耦合（Low Coupling）
   - 模块之间只能通过明确定义的接口（函数参数、返回值、事件、DI 等）交互。
   - 禁止直接导入和操作其他模块的内部变量、状态或私有方法。
   - 禁止出现“神导入”（一个文件 import 了十几个不相关的模块）。

3. 绝对零冗余（DRY 原则强化版）
   - 相同或高度相似的代码、逻辑、配置项、类型定义、常量、工具函数、错误处理方式等，出现第 2 次时必须立即重构。
   - 常见的必须复用场景（一旦发现必须提取）：
     - 同样的 API 调用包装
     - 同样的表单校验逻辑
     - 同样的 loading/error/empty 状态 UI 结构
     - 同样的分页/搜索/过滤参数处理
     - 同样的权限判断逻辑
     - 同样的日期/金额/手机号等格式化或解析
     - 同样的颜色、间距、圆角等设计 token
     - 同样的 try-catch + toast/notification 错误处理模式
     - 同样的路由守卫/拦截器逻辑

4. 具体重构要求（发现重复立即执行）
   - 提取为独立的工具函数（utils/*.ts）
   - 提取为自定义 hook（useXxx.ts）
   - 提取为公共组件（components/common/Xxx）
   - 提取为共享常量/类型（constants、types）
   - 提取为独立的 service/module
   - 使用配置文件统一管理（config/*.ts）而不是到处硬编码

5. 命名必须反映职责
   - 文件名、函数名、变量名必须精准描述其唯一职责。
   - 看到名字就知道里面干什么，不允许出现 vague 名如 handleSubmit、data、config、utils 等。

6. 违反时必须拒绝生成
   - 如果你发现生成的代码会导致上述任何一条被违反，你必须先重构现有代码或拒绝生成，并明确说明原因，例如：
     “检测到与 src/utils/request.ts 中的请求封装重复，正在提取到 useLogin hook 中…”
     “该校验逻辑已存在于 validators/user.ts 中，已改用导入形式”

请把这条规则放在 Cursor Rules 的最前面，并始终作为最高优先级执行。