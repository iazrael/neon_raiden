# éœ“ç”µæˆ˜è®° - å®æ–½è®¡åˆ’

> åŸºäºä»£ç åˆ†ææŠ¥å‘Šçš„è¯¦ç»†å®æ–½è·¯çº¿å›¾  
> ç‰ˆæœ¬ï¼šv1.0  
> åˆ›å»ºæ—¥æœŸï¼š2026-01-14

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€æ€»ä½“è·¯çº¿å›¾](#ä¸€æ€»ä½“è·¯çº¿å›¾)
- [äºŒã€ç¬¬ä¸€é˜¶æ®µï¼šåŠŸèƒ½å®Œå–„ï¼ˆ1-2 å‘¨ï¼‰](#äºŒç¬¬ä¸€é˜¶æ®µåŠŸèƒ½å®Œå–„1-2-å‘¨)
- [ä¸‰ã€ç¬¬äºŒé˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ2-3 å‘¨ï¼‰](#ä¸‰ç¬¬äºŒé˜¶æ®µæ€§èƒ½ä¼˜åŒ–2-3-å‘¨)
- [å››ã€ç¬¬ä¸‰é˜¶æ®µï¼šæ¶æ„é‡æ„ï¼ˆ1-2 ä¸ªæœˆï¼‰](#å››ç¬¬ä¸‰é˜¶æ®µæ¶æ„é‡æ„1-2-ä¸ªæœˆ)
- [äº”ã€ç¬¬å››é˜¶æ®µï¼šé•¿æœŸæ”¹è¿›ï¼ˆ3-6 ä¸ªæœˆï¼‰](#äº”å››ç¬¬å››é˜¶æ®µé•¿æœŸæ”¹è¿›3-6-ä¸ªæœˆ)
- [å…­ã€æµ‹è¯•ä¸éƒ¨ç½²](#å…­æµ‹è¯•ä¸éƒ¨ç½²)
- [ä¸ƒã€å›¢é˜Ÿåä½œ](#ä¸ƒå›¢é˜Ÿåä½œ)

---

## ä¸€ã€æ€»ä½“è·¯çº¿å›¾

### ä¼˜å…ˆçº§åˆ†ç±»

| ä¼˜å…ˆçº§ | ç±»åˆ« | é¢„è®¡å·¥ä½œé‡ | å½±å“èŒƒå›´ |
|--------|------|-----------|---------|
| **P0** | åŠŸèƒ½å®Œå–„ | 2 å‘¨ | é˜»å¡æ ¸å¿ƒåŠŸèƒ½ |
| **P1** | æ€§èƒ½ä¼˜åŒ– | 3 å‘¨ | ç”¨æˆ·ä½“éªŒå…³é”® |
| **P2** | æ¶æ„é‡æ„ | 2 ä¸ªæœˆ | é•¿æœŸå¯ç»´æŠ¤æ€§ |
| **P3** | é•¿æœŸæ”¹è¿› | 6 ä¸ªæœˆ | æˆ˜ç•¥æ€§æå‡ |

### æ—¶é—´çº¿

```
Week 1-2   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  åŠŸèƒ½å®Œå–„ï¼ˆP0ï¼‰
Week 3-5   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  æ€§èƒ½ä¼˜åŒ–ï¼ˆP1ï¼‰
Week 6-13  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  æ¶æ„é‡æ„ï¼ˆP2ï¼‰
Week 14+   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  é•¿æœŸæ”¹è¿›ï¼ˆP3ï¼‰
```

---

## äºŒã€ç¬¬ä¸€é˜¶æ®µï¼šåŠŸèƒ½å®Œå–„ï¼ˆ1-2 å‘¨ï¼‰

### ç›®æ ‡
å®Œæˆæœªå®ç°çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç¡®ä¿æ¸¸æˆå¯ç©æ€§è¾¾åˆ°åŸºæœ¬æ ‡å‡†ã€‚

### ä»»åŠ¡ 2.1ï¼šå®Œå–„å¿«ç…§ç³»ç»Ÿ

**é—®é¢˜æè¿°**ï¼š
- `snapshot.ts` å­˜åœ¨å¤§é‡ TODO é¡¹
- ç¼ºå°‘ UI éœ€è¦çš„å…³é”®çŠ¶æ€
- ç±»å‹å®šä¹‰ä¸å®é™…å®ç°ä¸ä¸€è‡´

**å®æ–½æ­¥éª¤**ï¼š

1. **è¡¥å……ç¼ºå¤±çš„çŠ¶æ€å­—æ®µ**
   ```typescript
   // src/engine/snapshot.ts
   export function buildSnapshot(world: World, t: number): GameSnapshot {
     // ... ç°æœ‰ä»£ç  ...
     
     // è¡¥å……å…³å¡è¿‡æ¸¡çŠ¶æ€
     const levelingSystem = world.levelingSystem; // éœ€è¦ä» LevelingSystem è·å–
     showLevelTransition: levelingSystem?.isTransitioning ?? false,
     levelTransitionTimer: levelingSystem?.transitionTimer ?? 0,
     
     // è¡¥å…… Boss é¢„è­¦çŠ¶æ€
     const bossSystem = world.bossSystem; // éœ€è¦ä» BossSystem è·å–
     showBossWarning: bossSystem?.isWarningActive ?? false,
     
     // è¡¥å……ç‚¸å¼¹æ•°é‡
     const bombComponent = player.find(Components.Bomb.check);
     bombs: bombComponent?.count ?? 0,
     
     // è¡¥å……ä¸»åŠ¨æ­¦å™¨ååŒ
     const synergies = getActiveSynergies(world, world.playerId);
     activeSynergies: synergies,
   }
   ```

2. **ç»Ÿä¸€ç±»å‹å®šä¹‰**
   ```typescript
   // src/ui/types.ts
   export interface GameSnapshot {
     // ç¡®ä¿ä¸ snapshot.ts å®šä¹‰ä¸€è‡´
     // æ·»åŠ å®Œæ•´çš„ JSDoc æ³¨é‡Š
   }
   ```

3. **æ›´æ–° System æ¥å£**
   ```typescript
   // src/engine/systems/LevelingSystem.ts
   export interface LevelingSystemState {
     isTransitioning: boolean;
     transitionTimer: number;
     // ... å…¶ä»–çŠ¶æ€
   }
   
   // src/engine/systems/BossSystem.ts
   export interface BossSystemState {
     isWarningActive: boolean;
     warningTimer: number;
     // ... å…¶ä»–çŠ¶æ€
   }
   ```

4. **æµ‹è¯•éªŒè¯**
   - è¿è¡Œæ¸¸æˆï¼Œç¡®è®¤ HUD æ˜¾ç¤ºæ­£å¸¸
   - éªŒè¯å…³å¡è¿‡æ¸¡åŠ¨ç”»
   - éªŒè¯ Boss é¢„è­¦æ˜¾ç¤º

**é¢„è®¡æ—¶é—´**ï¼š2 å¤©  
**é£é™©ç­‰çº§**ï¼šä½

---

### ä»»åŠ¡ 2.2ï¼šå®Œæˆ UI å±‚é‡æ„

**é—®é¢˜æè¿°**ï¼š
- UI ç»„ä»¶ä» `_old` ç›®å½•è¿ç§»è‡³ `src/ui/` æœªå®Œæˆ
- å¯¼å…¥è·¯å¾„ä¸ä¸€è‡´
- å¯èƒ½å­˜åœ¨åŠŸèƒ½ç¼ºå¤±

**å®æ–½æ­¥éª¤**ï¼š

1. **åˆ›å»ºå®Œæ•´çš„ UI ç»„ä»¶ç»“æ„**
   ```
   src/ui/
   â”œâ”€â”€ components/
   â”‚   â”œâ”€â”€ HUD.tsx           (å·²å­˜åœ¨)
   â”‚   â”œâ”€â”€ GameUI.tsx        (ä» _old è¿ç§»)
   â”‚   â”œâ”€â”€ MainMenu.tsx      (ä» _old è¿ç§»)
   â”‚   â”œâ”€â”€ PauseMenu.tsx     (ä» _old è¿ç§»)
   â”‚   â”œâ”€â”€ LevelUpModal.tsx  (ä» _old è¿ç§»)
   â”‚   â”œâ”€â”€ BossWarning.tsx   (ä» _old è¿ç§»)
   â”‚   â””â”€â”€ ComboDisplay.tsx  (ä» _old è¿ç§»)
   â”œâ”€â”€ hooks/
   â”‚   â””â”€â”€ useGameSnapshot.ts (æ–°å¢)
   â””â”€â”€ App.tsx               (ä»æ ¹ç›®å½•è¿ç§»)
   ```

2. **åˆ›å»ºè‡ªå®šä¹‰ Hook**
   ```typescript
   // src/ui/hooks/useGameSnapshot.ts
   import { useState, useEffect } from 'react';
   import { Engine } from '@/engine';
   
   export function useGameSnapshot(engine: Engine) {
     const [snapshot, setSnapshot] = useState(engine.snapshot$.value);
     
     useEffect(() => {
       const subscription = engine.snapshot$.subscribe(setSnapshot);
       return () => subscription.unsubscribe();
     }, [engine]);
     
     return snapshot;
   }
   ```

3. **é‡æ„ App.tsx**
   ```typescript
   // src/ui/App.tsx
   import { Engine } from '@/engine';
   import { Blueprint } from '@/engine/blueprints';
   import { useGameSnapshot } from './hooks/useGameSnapshot';
   import { GameUI } from './components/GameUI';
   import { HUD } from './components/HUD';
   
   export default function App() {
     const canvasRef = useRef<HTMLCanvasElement>(null);
     const [engine] = useState(() => new Engine());
     const snapshot = useGameSnapshot(engine);
     
     // ... å…¶ä½™é€»è¾‘
     
     return (
       <div className="relative w-full h-screen">
         <canvas ref={canvasRef} />
         {snapshot && (
           <>
             <HUD player={snapshot.player} />
             <GameUI snapshot={snapshot} engine={engine} />
           </>
         )}
       </div>
     );
   }
   ```

4. **ç»Ÿä¸€å¯¼å…¥è·¯å¾„**
   - æ›´æ–°æ‰€æœ‰ `import` è¯­å¥
   - ç¡®ä¿ TypeScript è·¯å¾„åˆ«åé…ç½®æ­£ç¡®
   - ç§»é™¤å¯¹ `_old` ç›®å½•çš„å¼•ç”¨

5. **åŠŸèƒ½éªŒè¯**
   - æµ‹è¯•æ‰€æœ‰ UI äº¤äº’
   - éªŒè¯èœå•åŠŸèƒ½
   - ç¡®è®¤æ ·å¼æ­£ç¡®

**é¢„è®¡æ—¶é—´**ï¼š3 å¤©  
**é£é™©ç­‰çº§**ï¼šä¸­

---

### ä»»åŠ¡ 2.3ï¼šå®Œæˆ EffectPlayer

**é—®é¢˜æè¿°**ï¼š
- `EffectPlayer.ts` å¤„äºæ¡†æ¶æ­å»ºé˜¶æ®µ
- ç²’å­ç”Ÿæˆé€»è¾‘ä¸å®Œæ•´
- ç¼ºå°‘å…·ä½“çš„ç²’å­æ¸²æŸ“å®ç°

**å®æ–½æ­¥éª¤**ï¼š

1. **è®¾è®¡ç²’å­æ•ˆæœé…ç½®**
   ```typescript
   // src/engine/configs/particles.ts
   export interface ParticleEffect {
     type: 'explosion' | 'blood' | 'spark' | 'trail';
     count: number;
     lifetime: number;
     speed: number;
     colors: string[];
     size: { min: number; max: number };
   }
   
   export const PARTICLE_EFFECTS: Record<string, ParticleEffect> = {
     EXPLOSION_SMALL: {
       type: 'explosion',
       count: 10,
       lifetime: 500,
       speed: 100,
       colors: ['#ff6600', '#ffcc00', '#ffffff'],
       size: { min: 2, max: 5 }
     },
     EXPLOSION_BIG: {
       type: 'explosion',
       count: 30,
       lifetime: 800,
       speed: 200,
       colors: ['#ff0000', '#ff6600', '#ffcc00'],
       size: { min: 5, max: 15 }
     },
     BLOOD: {
       type: 'blood',
       count: 8,
       lifetime: 300,
       speed: 80,
       colors: ['#cc0000', '#880000'],
       size: { min: 2, max: 4 }
     }
   };
   ```

2. **å®ç°ç²’å­ç”Ÿæˆé€»è¾‘**
   ```typescript
   // src/engine/systems/EffectPlayer.ts
   import { World } from '@/engine/types';
   import { pushEvent } from '@/engine/world';
   import { Particle } from '@/engine/components/render';
   import { Transform, Velocity, Lifetime } from '@/engine/components/base';
   import { PARTICLE_EFFECTS } from '@/engine/configs/particles';
   
   export function EffectPlayer(world: World, dt: number) {
     // å¤„ç† HitEvent
     const hitEvents = world.events.filter(e => e.type === 'Hit');
     for (const event of hitEvents) {
       spawnParticles(world, event.pos, 'EXPLOSION_SMALL', event.bloodLevel);
     }
     
     // å¤„ç† KillEvent
     const killEvents = world.events.filter(e => e.type === 'Kill');
     for (const event of killEvents) {
       spawnParticles(world, event.pos, 'EXPLOSION_BIG', 3);
     }
     
     // å¤„ç† BloodFogEvent
     const bloodFogEvents = world.events.filter(e => e.type === 'BloodFog');
     for (const event of bloodFogEvents) {
       spawnParticles(world, event.pos, 'BLOOD', event.level);
     }
   }
   
   function spawnParticles(world: World, pos: { x: number; y: number }, 
                          effectType: string, level: number) {
     const effect = PARTICLE_EFFECTS[effectType];
     if (!effect) return;
     
     const count = Math.floor(effect.count * level);
     
     for (let i = 0; i < count; i++) {
       const id = generateId();
       const angle = Math.random() * Math.PI * 2;
       const speed = effect.speed * (0.5 + Math.random());
       const size = effect.size.min + Math.random() * (effect.size.max - effect.size.min);
       const color = effect.colors[Math.floor(Math.random() * effect.colors.length)];
       
       world.entities.set(id, [
         new Transform({ x: pos.x, y: pos.y, rot: angle }),
         new Velocity({ 
           vx: Math.cos(angle) * speed, 
           vy: Math.sin(angle) * speed 
         }),
         new Lifetime({ timer: effect.lifetime }),
         new Particle({
           frame: 0,
           maxFrame: 1,
           fps: 60,
           color: color,
           size: size,
           alpha: 1.0
         })
       ]);
     }
   }
   ```

3. **å¢å¼º Particle ç»„ä»¶**
   ```typescript
   // src/engine/components/render.ts
   export class Particle extends Component {
     constructor(cfg: {
       frame: number;
       maxFrame: number;
       fps: number;
       color?: string;
       size?: number;
       alpha?: number;
     }) {
       super();
       this.frame = cfg.frame;
       this.maxFrame = cfg.maxFrame;
       this.fps = cfg.fps;
       this.color = cfg.color ?? '#ffffff';
       this.size = cfg.size ?? 4;
       this.alpha = cfg.alpha ?? 1.0;
     }
     
     public frame: number;
     public maxFrame: number;
     public fps: number;
     public color: string;
     public size: number;
     public alpha: number;
     private frameTimer: number = 0;
     
     update(dt: number): void {
       this.frameTimer += dt;
       if (this.frameTimer >= 1000 / this.fps) {
         this.frame++;
         this.frameTimer = 0;
       }
       
       // æ·¡å‡ºæ•ˆæœ
       const progress = this.frame / this.maxFrame;
       this.alpha = 1.0 - progress;
     }
     
     isFinished(): boolean {
       return this.frame >= this.maxFrame;
     }
     
     static check(c: any): c is Particle {
       return c instanceof Particle;
     }
   }
   ```

4. **æ›´æ–° RenderSystem**
   ```typescript
   // src/engine/systems/RenderSystem.ts
   // æ·»åŠ ç²’å­æ¸²æŸ“
   for (const [id, [tr, particle]] of view(world, [Transform, Particle])) {
     ctx.save();
     ctx.globalAlpha = particle.alpha;
     ctx.fillStyle = particle.color;
     ctx.beginPath();
     ctx.arc(tr.x, tr.y, particle.size, 0, Math.PI * 2);
     ctx.fill();
     ctx.restore();
     
     // æ›´æ–°ç²’å­
     particle.update(dt);
     
     // æ ‡è®°é”€æ¯
     if (particle.isFinished()) {
       pushEvent(world, { type: 'EntityDestroy', entityId: id });
     }
   }
   ```

5. **æµ‹è¯•éªŒè¯**
   - æµ‹è¯•å‡»ä¸­æ•ˆæœ
   - æµ‹è¯•çˆ†ç‚¸æ•ˆæœ
   - æµ‹è¯•è¡€é›¾æ•ˆæœ
   - æ€§èƒ½æµ‹è¯•ï¼ˆå¤§é‡ç²’å­ï¼‰

**é¢„è®¡æ—¶é—´**ï¼š3 å¤©  
**é£é™©ç­‰çº§**ï¼šä¸­

---

### ä»»åŠ¡ 2.4ï¼šå®ç°ç‚¸å¼¹ç³»ç»Ÿ

**é—®é¢˜æè¿°**ï¼š
- `BombIntent` ç»„ä»¶å·²å®šä¹‰
- ä½†ç‚¸å¼¹ç³»ç»Ÿé€»è¾‘æœªå®ç°
- UI æ˜¾ç¤ºç‚¸å¼¹æ•°é‡ï¼Œä½†æ— æ³•ä½¿ç”¨

**å®æ–½æ­¥éª¤**ï¼š

1. **åˆ›å»º Bomb ç»„ä»¶**
   ```typescript
   // src/engine/components/combat.ts (æ–°å¢)
   export class Bomb extends Component {
     constructor(cfg: {
       count: number;
       maxCount: number;
       cooldown: number;
       radius: number;
       damage: number;
     }) {
       super();
       this.count = cfg.count;
       this.maxCount = cfg.maxCount;
       this.cooldown = cfg.cooldown;
       this.radius = cfg.radius;
       this.damage = cfg.damage;
       this.currentCooldown = 0;
     }
     
     public count: number;
     public maxCount: number;
     public cooldown: number;
     public radius: number;
     public damage: number;
     public currentCooldown: number;
     
     update(dt: number): void {
       if (this.currentCooldown > 0) {
         this.currentCooldown -= dt;
       }
     }
     
     canUse(): boolean {
       return this.count > 0 && this.currentCooldown <= 0;
     }
     
     use(): void {
       if (this.canUse()) {
         this.count--;
         this.currentCooldown = this.cooldown;
       }
     }
     
     static check(c: any): c is Bomb {
       return c instanceof Bomb;
     }
   }
   ```

2. **å®ç° BombSystem**
   ```typescript
   // src/engine/systems/BombSystem.ts
   import { World } from '@/engine/types';
   import { view } from '@/engine/world';
   import { Bomb, Transform, DamageOverTime, InvulnerableState } from '@/engine/components';
   import { pushEvent } from '@/engine/world';
   import { KillEvent, HitEvent, CamShakeEvent, ScreenClearEvent } from '@/engine/events';
   import { spawnParticles } from './EffectPlayer';
   
   export function BombSystem(world: World, dt: number) {
     // æ›´æ–°å†·å´
     for (const [id, [bomb]] of view(world, [Bomb])) {
       bomb.update(dt);
     }
     
     // å¤„ç† BombIntent
     for (const [id, [player, bomb, tr]] of view(world, [PlayerTag, Bomb, Transform])) {
       if (bomb.canUse()) {
         // ä½¿ç”¨ç‚¸å¼¹
         bomb.use();
         
         // éœ‡å±
         pushEvent(world, {
           type: 'CamShake',
           intensity: 20,
           duration: 0.5
         });
         
         // æ¸…å±äº‹ä»¶
         pushEvent(world, {
           type: 'ScreenClear'
         });
         
         // ç‰¹æ•ˆ
         spawnParticles(world, tr, 'EXPLOSION_BIG', 5);
         
         // å¯¹æ‰€æœ‰æ•Œäººé€ æˆä¼¤å®³
         for (const [enemyId, [enemyTr, health, enemyTag]] of 
              view(world, [Transform, Health, EnemyTag, BossTag])) {
           const distance = Math.hypot(enemyTr.x - tr.x, enemyTr.y - tr.y);
           
           if (distance <= bomb.radius) {
             // é€ æˆä¼¤å®³
             const damage = bomb.damage * (1 - distance / bomb.radius);
             pushEvent(world, {
               type: 'Hit',
               pos: { x: enemyTr.x, y: enemyTr.y },
               damage: damage,
               owner: id,
               victim: enemyId,
               bloodLevel: 3
             });
           }
         }
       }
     }
   }
   ```

3. **æ›´æ–° InputSystem**
   ```typescript
   // src/engine/systems/InputSystem.ts
   // æ·»åŠ ç‚¸å¼¹è¾“å…¥å¤„ç†
   if (InputManager.getInstance().isKeyPressed('Space') || 
       InputManager.getInstance().isKeyPressed('KeyB')) {
     for (const [id] of view(world, [PlayerTag])) {
       const bomb = world.entities.get(id)?.find(Bomb.check);
       if (bomb?.canUse()) {
         addComponent(world, id, new BombIntent());
       }
     }
   }
   ```

4. **æ›´æ–° UI**
   ```typescript
   // src/ui/components/GameUI.tsx
   // æ·»åŠ ç‚¸å¼¹æŒ‰é’®
   <button 
     onClick={() => engine?.useBomb()}
     disabled={snapshot?.player.bombs === 0}
     className="bomb-button"
   >
     ğŸ’£ {snapshot?.player.bombs}
   </button>
   ```

5. **æµ‹è¯•éªŒè¯**
   - æµ‹è¯•ç‚¸å¼¹å†·å´
   - æµ‹è¯•ç‚¸å¼¹ä¼¤å®³èŒƒå›´
   - æµ‹è¯•ç‚¸å¼¹ç‰¹æ•ˆ
   - UI äº¤äº’æµ‹è¯•

**é¢„è®¡æ—¶é—´**ï¼š2 å¤©  
**é£é™©ç­‰çº§**ï¼šä½

---

### ä»»åŠ¡ 2.5ï¼šå®ç°å…³å¡åˆ‡æ¢

**é—®é¢˜æè¿°**ï¼š
- `levels.ts` å®šä¹‰äº†å…³å¡é…ç½®
- ä½†å…³å¡åˆ‡æ¢é€»è¾‘æœªå®ç°
- `showLevelTransition` å§‹ç»ˆä¸º false

**å®æ–½æ­¥éª¤**ï¼š

1. **æ‰©å±•å…³å¡é…ç½®**
   ```typescript
   // src/engine/configs/levels.ts
   export interface LevelConfig {
     id: number;
     name: string;
     duration: number;          // å…³å¡æ—¶é•¿ï¼ˆç§’ï¼‰
     enemySpawnRate: number;     // æ•Œäººç”Ÿæˆé€Ÿç‡
     bossId?: string;            // Boss IDï¼ˆå¯é€‰ï¼‰
     background?: string;         // èƒŒæ™¯å›¾
     music?: string;              // èƒŒæ™¯éŸ³ä¹
   }
   
   export const LEVELS: LevelConfig[] = [
     {
       id: 1,
       name: "åˆæ¬¡æ¥è§¦",
       duration: 60,
       enemySpawnRate: 2.0,
       background: "bg_space.png"
     },
     {
       id: 2,
       name: "æ•Œæ–¹å¢æ´",
       duration: 90,
       enemySpawnRate: 1.5,
       background: "bg_planet.png"
     },
     // ... æ›´å¤šå…³å¡
   ];
   ```

2. **å®ç° LevelingSystem**
   ```typescript
   // src/engine/systems/LevelingSystem.ts
   import { World } from '@/engine/types';
   import { view } from '@/engine/world';
   import { PlayerTag, Health } from '@/engine/components';
   import { LEVELS } from '@/engine/configs/levels';
   
   export interface LevelingSystemState {
     currentLevel: number;
     levelTimer: number;
     isTransitioning: boolean;
     transitionTimer: number;
     maxLevelReached: number;
   }
   
   export function LevelingSystem(world: World, dt: number) {
     // åˆå§‹åŒ–ç³»ç»ŸçŠ¶æ€
     if (!world.levelingSystem) {
       world.levelingSystem = {
         currentLevel: 1,
         levelTimer: 0,
         isTransitioning: false,
         transitionTimer: 0,
         maxLevelReached: 1
       };
     }
     
     const state = world.levelingSystem;
     const levelConfig = LEVELS.find(l => l.id === state.currentLevel);
     
     if (!levelConfig) return;
     
     if (!state.isTransitioning) {
       // æ­£å¸¸æ¸¸æˆçŠ¶æ€
       state.levelTimer += dt / 1000;
       
       // æ£€æŸ¥æ˜¯å¦å®Œæˆå…³å¡
       if (state.levelTimer >= levelConfig.duration) {
         startLevelTransition(world, state);
       }
     } else {
       // å…³å¡è¿‡æ¸¡çŠ¶æ€
       state.transitionTimer += dt / 1000;
       
       if (state.transitionTimer >= 3) { // 3 ç§’è¿‡æ¸¡
         endLevelTransition(world, state);
       }
     }
   }
   
   function startLevelTransition(world: World, state: LevelingSystemState) {
     state.isTransitioning = true;
     state.transitionTimer = 0;
     
     // ä¿å­˜å½“å‰å…³å¡çš„æœ€é«˜è®°å½•
     if (state.currentLevel > state.maxLevelReached) {
       state.maxLevelReached = state.currentLevel;
     }
   }
   
   function endLevelTransition(world: World, state: LevelingSystemState) {
     state.isTransitioning = false;
     state.levelTimer = 0;
     state.currentLevel++;
     
     // å¦‚æœè¶…è¿‡æœ€å¤§å…³å¡ï¼Œå¾ªç¯åˆ°æœ€åä¸€ä¸ª
     if (state.currentLevel > LEVELS.length) {
       state.currentLevel = LEVELS.length;
     }
     
     // å‡çº§ç©å®¶
     pushEvent(world, {
       type: 'LevelUp',
       oldLevel: state.currentLevel - 1,
       newLevel: state.currentLevel,
       source: 'levelEnd'
     });
     
     // æ¸…ç†å½“å‰å…³å¡æ•Œäºº
     for (const [id, [enemyTag]] of view(world, [EnemyTag])) {
       pushEvent(world, { type: 'EntityDestroy', entityId: id });
     }
   }
   ```

3. **æ›´æ–°å¿«ç…§ç³»ç»Ÿ**
   ```typescript
   // src/engine/snapshot.ts
   const levelingSystem = world.levelingSystem;
   showLevelTransition: levelingSystem?.isTransitioning ?? false,
   levelTransitionTimer: levelingSystem?.transitionTimer ?? 0,
   maxLevelReached: levelingSystem?.maxLevelReached ?? 1,
   ```

4. **æ·»åŠ å…³å¡è¿‡æ¸¡ UI**
   ```typescript
   // src/ui/components/LevelTransition.tsx
   import { GameSnapshot } from '@/engine/types';
   
   export function LevelTransition({ snapshot }: { snapshot: GameSnapshot }) {
     if (!snapshot.showLevelTransition) return null;
     
     return (
       <div className="level-transition">
         <h2>LEVEL {snapshot.level} COMPLETED!</h2>
         <p>å³å°†è¿›å…¥ä¸‹ä¸€å…³...</p>
       </div>
     );
   }
   ```

5. **æµ‹è¯•éªŒè¯**
   - æµ‹è¯•å…³å¡è®¡æ—¶
   - æµ‹è¯•å…³å¡è¿‡æ¸¡
   - æµ‹è¯•ç©å®¶å‡çº§
   - æµ‹è¯•å…³å¡å¾ªç¯

**é¢„è®¡æ—¶é—´**ï¼š3 å¤©  
**é£é™©ç­‰çº§**ï¼šä¸­

---

### ç¬¬ä¸€é˜¶æ®µæ€»ç»“

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | ä¼˜å…ˆçº§ | é£é™© |
|------|---------|--------|------|
| å®Œå–„å¿«ç…§ç³»ç»Ÿ | 2 å¤© | P0 | ä½ |
| å®Œæˆ UI å±‚é‡æ„ | 3 å¤© | P0 | ä¸­ |
| å®Œæˆ EffectPlayer | 3 å¤© | P0 | ä¸­ |
| å®ç°ç‚¸å¼¹ç³»ç»Ÿ | 2 å¤© | P0 | ä½ |
| å®ç°å…³å¡åˆ‡æ¢ | 3 å¤© | P0 | ä¸­ |
| **æ€»è®¡** | **13 å¤© (~2 å‘¨)** | **P0** | **ä¸­** |

**äº¤ä»˜ç‰©**ï¼š
- å®Œæ•´å¯ç©çš„æ¸¸æˆ
- UI å±‚é‡æ„å®Œæˆ
- ç‰¹æ•ˆç³»ç»Ÿå®Œå–„
- æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## ä¸‰ã€ç¬¬äºŒé˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ2-3 å‘¨ï¼‰

### ç›®æ ‡
ä¼˜åŒ–æ¸¸æˆæ€§èƒ½ï¼Œç¡®ä¿åœ¨ä½ç«¯è®¾å¤‡ä¸Šä¹Ÿèƒ½ç¨³å®šè¿è¡Œ 60 FPSã€‚

### ä»»åŠ¡ 3.1ï¼šä¼˜åŒ–ç¢°æ’æ£€æµ‹

**é—®é¢˜æè¿°**ï¼š
- `CollisionSystem` ä½¿ç”¨ O(NÂ²) åŒé‡å¾ªç¯
- 100 ä¸ªå®ä½“æ—¶æ¯å¸§ 10,000 æ¬¡æ£€æµ‹
- æ€§èƒ½ç“¶é¢ˆæ˜æ˜¾

**è§£å†³æ–¹æ¡ˆ**ï¼šå¼•å…¥ç©ºé—´ç´¢å¼•

#### æ–¹æ¡ˆ Aï¼šQuadtreeï¼ˆæ¨èï¼‰

1. **å®ç° Quadtree**
   ```typescript
   // src/engine/utils/Quadtree.ts
   export class Quadtree {
     private bounds: Rectangle;
     private capacity: number;
     private points: QuadtreePoint[] = [];
     private divided: boolean = false;
     private northwest?: Quadtree;
     private northeast?: Quadtree;
     private southwest?: Quadtree;
     private southeast?: Quadtree;
     
     constructor(bounds: Rectangle, capacity: number = 10) {
       this.bounds = bounds;
       this.capacity = capacity;
     }
     
     insert(point: QuadtreePoint): boolean {
       if (!this.contains(this.bounds, point)) {
         return false;
       }
       
       if (this.points.length < this.capacity) {
         this.points.push(point);
         return true;
       }
       
       if (!this.divided) {
         this.subdivide();
       }
       
       return (this.northwest!.insert(point) ||
               this.northeast!.insert(point) ||
               this.southwest!.insert(point) ||
               this.southeast!.insert(point));
     }
     
     query(range: Rectangle, found: QuadtreePoint[] = []): QuadtreePoint[] {
       if (!this.intersects(this.bounds, range)) {
         return found;
       }
       
       for (const point of this.points) {
         if (this.contains(range, point)) {
           found.push(point);
         }
       }
       
       if (this.divided) {
         this.northwest!.query(range, found);
         this.northeast!.query(range, found);
         this.southwest!.query(range, found);
         this.southeast!.query(range, found);
       }
       
       return found;
     }
     
     private subdivide() {
       const x = this.bounds.x;
       const y = this.bounds.y;
       const w = this.bounds.w / 2;
       const h = this.bounds.h / 2;
       
       this.northwest = new Quadtree({ x, y, w, h }, this.capacity);
       this.northeast = new Quadtree({ x: x + w, y, w, h }, this.capacity);
       this.southwest = new Quadtree({ x, y: y + h, w, h }, this.capacity);
       this.southeast = new Quadtree({ x: x + w, y: y + h, w, h }, this.capacity);
       
       this.divided = true;
     }
     
     clear() {
       this.points = [];
       this.divided = false;
       this.northwest = undefined;
       this.northeast = undefined;
       this.southwest = undefined;
       this.southeast = undefined;
     }
     
     private contains(bounds: Rectangle, point: QuadtreePoint): boolean {
       return point.x >= bounds.x && 
              point.x < bounds.x + bounds.w &&
              point.y >= bounds.y && 
              point.y < bounds.y + bounds.h;
     }
     
     private intersects(bounds1: Rectangle, bounds2: Rectangle): boolean {
       return !(bounds2.x >= bounds1.x + bounds1.w ||
                bounds2.x + bounds2.w <= bounds1.x ||
                bounds2.y >= bounds1.y + bounds1.h ||
                bounds2.y + bounds2.h <= bounds1.y);
     }
   }
   
   interface Rectangle {
     x: number;
     y: number;
     w: number;
     h: number;
   }
   
   interface QuadtreePoint {
     x: number;
     y: number;
     entityId: number;
     userData?: any;
   }
   ```

2. **é‡æ„ CollisionSystem**
   ```typescript
   // src/engine/systems/CollisionSystem.ts
   import { Quadtree } from '@/engine/utils/Quadtree';
   
   let quadtree: Quadtree | null = null;
   
   export function CollisionSystem(world: World, dt: number) {
     // åˆå§‹åŒ– Quadtree
     if (!quadtree) {
       quadtree = new Quadtree({
         x: 0,
         y: 0,
         w: world.width,
         h: world.height
       }, 10);
     }
     
     quadtree.clear();
     
     // æ’å…¥æ‰€æœ‰æœ‰ HitBox çš„å®ä½“
     for (const [id, [tr, hb]] of view(world, [Transform, HitBox])) {
       const radius = hb.shape === 'circle' ? hb.radius! : 
                     Math.max(hb.halfWidth!, hb.halfHeight!);
       
       quadtree.insert({
         x: tr.x - radius,
         y: tr.y - radius,
         entityId: id,
         userData: { tr, hb }
       });
     }
     
     // æŸ¥è¯¢ç¢°æ’
     for (const [id, [tr, hb]] of view(world, [Transform, HitBox])) {
       const radius = hb.shape === 'circle' ? hb.radius! : 
                     Math.max(hb.halfWidth!, hb.halfHeight!);
       
       const range = {
         x: tr.x - radius * 2,
         y: tr.y - radius * 2,
         w: radius * 4,
         h: radius * 4
       };
       
       const nearby = quadtree.query(range);
       
       for (const point of nearby) {
         if (point.entityId === id) continue;
         
        const otherTr = point.userData.tr;
        const otherHb = point.userData.hb;
        
        if (checkCollision(tr, hb, otherTr, otherHb)) {
          handleCollision(world, id, point.entityId);
        }
      }
    }
   }
   ```

3. **æ€§èƒ½å¯¹æ¯”æµ‹è¯•**
   - æµ‹è¯•ä¸åŒå®ä½“æ•°é‡çš„æ€§èƒ½
   - å¯¹æ¯” O(NÂ²) vs O(N log N)
   - éªŒè¯ 60 FPS ç¨³å®šæ€§

**é¢„è®¡æ—¶é—´**ï¼š5 å¤©  
**é£é™©ç­‰çº§**ï¼šä¸­

---

### ä»»åŠ¡ 3.2ï¼šä¼˜åŒ–è§†å›¾æŸ¥è¯¢

**é—®é¢˜æè¿°**ï¼š
- `view` å‡½æ•°ä½¿ç”¨ `instanceof` éå†æ‰€æœ‰å®ä½“
- æ¯æ¬¡æŸ¥è¯¢éƒ½è¦éå†æ•´ä¸ªå®ä½“ Map
- æ— ç¼“å­˜æœºåˆ¶ï¼Œé‡å¤è®¡ç®—

**è§£å†³æ–¹æ¡ˆ**ï¼šæ·»åŠ ç»„ä»¶ç´¢å¼•

1. **å®ç°ç»„ä»¶ç´¢å¼•**
   ```typescript
   // src/engine/world.ts (æ‰©å±•)
   export interface World {
     // ... ç°æœ‰å±æ€§
     componentIndexes: Map<any, Set<EntityId>>;  // ç»„ä»¶ç±»å‹ â†’ å®ä½“ ID é›†åˆ
   }
   
   export function addComponent<T extends Component>(w: World, id: EntityId, comp: T) {
     if (!w.entities.has(id)) w.entities.set(id, []);
     w.entities.get(id)!.push(comp);
     
     // æ›´æ–°ç´¢å¼•
     const compType = comp.constructor;
     if (!w.componentIndexes.has(compType)) {
       w.componentIndexes.set(compType, new Set());
     }
     w.componentIndexes.get(compType)!.add(id);
   }
   
   export function removeComponent<T extends Component>(w: World, id: EntityId, comp: T) {
     const comps = w.entities.get(id);
     if (comps) {
       const index = comps.indexOf(comp);
       if (index !== -1) {
         comps.splice(index, 1);
         
         // æ›´æ–°ç´¢å¼•
         const compType = comp.constructor;
         w.componentIndexes.get(compType)?.delete(id);
       }
     }
   }
   
   export function removeEntity(w: World, id: EntityId) {
     const comps = w.entities.get(id);
     if (comps) {
       // æ›´æ–°æ‰€æœ‰ç´¢å¼•
       for (const comp of comps) {
         const compType = comp.constructor;
         w.componentIndexes.get(compType)?.delete(id);
       }
     }
     w.entities.delete(id);
   }
   
   // ä¼˜åŒ–åçš„ view å‡½æ•°
   export function* view<T extends Ctor[]>(w: World, types: [...T]): Iterable<[EntityId, InstanceTuple<T>]> {
     // æ‰¾åˆ°å®ä½“æ•°é‡æœ€å°‘çš„ç»„ä»¶ç±»å‹
     const minType = types.reduce((min, curr) => {
       const minSize = w.componentIndexes.get(min)?.size ?? 0;
       const currSize = w.componentIndexes.get(curr)?.size ?? 0;
       return currSize < minSize ? curr : min;
     });
     
     const candidateIds = w.componentIndexes.get(minType) ?? [];
     const len = types.length;
     
     for (const id of candidateIds) {
       const comps = w.entities.get(id);
       if (!comps) continue;
       
       const bucket: any[] = [];
       let hasAll = true;
       
       for (let i = 0; i < len; i++) {
         const Ctor = types[i];
         const found = comps.find(c => c instanceof Ctor);
         
         if (!found) {
           hasAll = false;
           break;
         }
         bucket.push(found);
       }
       
       if (hasAll) {
         yield [id, bucket as unknown as InstanceTuple<T>];
       }
     }
   }
   ```

2. **åˆå§‹åŒ–ç´¢å¼•**
   ```typescript
   // src/engine/world.ts
   export function createWorld(): World {
     return {
       time: 0,
       entities: new Map(),
       events: [],
       score: 0,
       level: 1,
       playerId: 0,
       playerLevel: 1,
       difficulty: 1,
       spawnCredits: 0,
       spawnTimer: 0,
       enemyCount: 0,
       width: 0,
       height: 0,
       componentIndexes: new Map()  // æ–°å¢
     };
   }
   ```

3. **æ€§èƒ½æµ‹è¯•**
   - æµ‹è¯•æŸ¥è¯¢é€Ÿåº¦æå‡
   - éªŒè¯ç´¢å¼•ç»´æŠ¤æˆæœ¬
   - ç¡®ä¿å†…å­˜ä½¿ç”¨åˆç†

**é¢„è®¡æ—¶é—´**ï¼š3 å¤©  
**é£é™©ç­‰çº§**ï¼šä½

---

### ä»»åŠ¡ 3.3ï¼šæ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

**é—®é¢˜æè¿°**ï¼š
- æ¯å¸§éƒ½ç»˜åˆ¶æ‰€æœ‰å®ä½“
- æ— è§†é”¥ä½“å‰”é™¤
- æ— æ‰¹é‡ç»˜åˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å®ç°è§†é”¥ä½“å‰”é™¤**
   ```typescript
   // src/engine/systems/RenderSystem.ts
   export function RenderSystem(ctx: CanvasRenderingContext2D, world: World) {
     // æ¸…é™¤ç”»å¸ƒ
     ctx.clearRect(0, 0, world.width, world.height);
     
     // åº”ç”¨ç›¸æœºå˜æ¢
     ctx.save();
     const camera = world.camera;
     if (camera) {
       ctx.translate(-camera.x + world.width / 2, -camera.y + world.height / 2);
     }
     
     // è®¡ç®—å¯è§åŒºåŸŸ
     const visibleRect = {
       x: camera.x - world.width / 2,
       y: camera.y - world.height / 2,
       w: world.width,
       h: world.height
     };
     
     // åªç»˜åˆ¶å¯è§å®ä½“
     for (const [id, [tr, sprite]] of view(world, [Transform, Sprite])) {
       if (!isVisible(tr, sprite, visibleRect)) continue;
       
       // ... ç»˜åˆ¶é€»è¾‘
     }
     
     ctx.restore();
   }
   
   function isVisible(tr: Transform, sprite: Sprite, rect: Rectangle): boolean {
     const size = sprite.scale * (sprite.srcW ?? 32);
     const left = tr.x - size / 2;
     const right = tr.x + size / 2;
     const top = tr.y - size / 2;
     const bottom = tr.y + size / 2;
     
     return !(right < rect.x || 
              left > rect.x + rect.w ||
              bottom < rect.y || 
              top > rect.y + rect.h);
   }
   ```

2. **å®ç°æ‰¹é‡ç»˜åˆ¶**
   ```typescript
   // æŒ‰çº¹ç†æ‰¹é‡ç»˜åˆ¶
   const batches: Map<string, [EntityId, Transform, Sprite][]> = new Map();
   
   for (const [id, [tr, sprite]] of view(world, [Transform, Sprite])) {
     if (!isVisible(tr, sprite, visibleRect)) continue;
     
     if (!batches.has(sprite.image)) {
       batches.set(sprite.image, []);
     }
     batches.get(sprite.image)!.push([id, tr, sprite]);
   }
   
   // æ‰¹é‡ç»˜åˆ¶
   for (const [image, entities] of batches) {
     const img = assets.get(image);
     if (!img) continue;
     
     for (const [, tr, sprite] of entities) {
       ctx.save();
       ctx.translate(tr.x, tr.y);
       ctx.rotate(tr.rot);
       ctx.scale(sprite.scale, sprite.scale);
       
       ctx.drawImage(
         img,
         sprite.srcX ?? 0, sprite.srcY ?? 0,
         sprite.srcW ?? 32, sprite.srcH ?? 32,
         -sprite.srcW! / 2, -sprite.srcH! / 2,
         sprite.srcW ?? 32, sprite.srcH ?? 32
       );
       
       ctx.restore();
     }
   }
   ```

3. **ä½¿ç”¨ç¦»å± Canvas ç¼“å­˜**
   ```typescript
   // ç¼“å­˜é™æ€èƒŒæ™¯
   const backgroundCanvas = document.createElement('canvas');
   backgroundCanvas.width = world.width;
   backgroundCanvas.height = world.height;
   const bgCtx = backgroundCanvas.getContext('2d')!;
   
   // é¢„æ¸²æŸ“èƒŒæ™¯
   function renderBackground(ctx: CanvasRenderingContext2D, world: World) {
     if (!world.backgroundCached) {
       // æ¸²æŸ“åˆ°ç¦»å± Canvas
       bgCtx.drawImage(assets.get('background.png'), 0, 0);
       world.backgroundCached = true;
     }
     
     // ç›´æ¥ç»˜åˆ¶ç¼“å­˜çš„èƒŒæ™¯
     ctx.drawImage(backgroundCanvas, 0, 0);
   }
   ```

**é¢„è®¡æ—¶é—´**ï¼š3 å¤©  
**é£é™©ç­‰çº§**ï¼šä½

---

### ä»»åŠ¡ 3.4ï¼šå†…å­˜ä¼˜åŒ–

**é—®é¢˜æè¿°**ï¼š
- é¢‘ç¹åˆ›å»º/é”€æ¯å¯¹è±¡
- GC æŠ–åŠ¨å½±å“æ€§èƒ½
- å†…å­˜æ³„æ¼é£é™©

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ‰©å±•å¯¹è±¡æ± **
   ```typescript
   // src/engine/world.ts
   export const pools: Record<string, Component[][]> = {
     bullet: [],
     enemy: [],
     pickup: [],
     particle: [],  // æ–°å¢ç²’å­æ± 
     effect: [],    // æ–°å¢ç‰¹æ•ˆæ± 
   };
   ```

2. **å®ç°å†…å­˜ç›‘æ§**
   ```typescript
   // src/engine/utils/MemoryMonitor.ts
   export class MemoryMonitor {
     private static instance: MemoryMonitor;
     private memoryData: { timestamp: number; used: number }[] = [];
     
     private constructor() {
       setInterval(() => this.record(), 1000);
     }
     
     static getInstance(): MemoryMonitor {
       if (!MemoryMonitor.instance) {
         MemoryMonitor.instance = new MemoryMonitor();
       }
       return MemoryMonitor.instance;
     }
     
     private record() {
       if (performance.memory) {
         this.memoryData.push({
           timestamp: Date.now(),
           used: performance.memory.usedJSHeapSize / 1024 / 1024
         });
         
         // åªä¿ç•™æœ€è¿‘ 5 åˆ†é’Ÿçš„æ•°æ®
         if (this.memoryData.length > 300) {
           this.memoryData.shift();
         }
       }
     }
     
     getStats() {
       return {
         current: this.memoryData[this.memoryData.length - 1]?.used ?? 0,
         max: Math.max(...this.memoryData.map(d => d.used))
       };
     }
   }
   ```

3. **æ£€æµ‹å†…å­˜æ³„æ¼**
   ```typescript
   // æ·»åŠ åˆ° Engine
   export class Engine {
     private memoryMonitor = MemoryMonitor.getInstance();
     
     start(canvas: HTMLCanvasElement, bp: Blueprint) {
       // ... ç°æœ‰ä»£ç 
       
       // å®šæœŸæ£€æŸ¥å†…å­˜æ³„æ¼
       setInterval(() => {
         const stats = this.memoryMonitor.getStats();
         if (stats.current > stats.max * 1.5) {
           console.warn('Potential memory leak detected:', stats);
         }
       }, 10000);
     }
   }
   ```

**é¢„è®¡æ—¶é—´**ï¼š2 å¤©  
**é£é™©ç­‰çº§**ï¼šä½

---

### ç¬¬äºŒé˜¶æ®µæ€»ç»“

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | ä¼˜å…ˆçº§ | é£é™© |
|------|---------|--------|------|
| ä¼˜åŒ–ç¢°æ’æ£€æµ‹ | 5 å¤© | P1 | ä¸­ |
| ä¼˜åŒ–è§†å›¾æŸ¥è¯¢ | 3 å¤© | P1 | ä½ |
| æ¸²æŸ“æ€§èƒ½ä¼˜åŒ– | 3 å¤© | P1 | ä½ |
| å†…å­˜ä¼˜åŒ– | 2 å¤© | P1 | ä½ |
| **æ€»è®¡** | **13 å¤© (~3 å‘¨)** | **P1** | **ä½** |

**äº¤ä»˜ç‰©**ï¼š
- ç¢°æ’æ£€æµ‹æ€§èƒ½æå‡ 10 å€ä»¥ä¸Š
- è§†å›¾æŸ¥è¯¢æ€§èƒ½æå‡ 5 å€ä»¥ä¸Š
- æ¸²æŸ“å¸§ç‡ç¨³å®šåœ¨ 60 FPS
- å†…å­˜ä½¿ç”¨ä¼˜åŒ– 30%

---

## å››ã€ç¬¬ä¸‰é˜¶æ®µï¼šæ¶æ„é‡æ„ï¼ˆ1-2 ä¸ªæœˆï¼‰

### ç›®æ ‡
é‡æ„ä»£ç æ¶æ„ï¼Œæå‡å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚

### ä»»åŠ¡ 4.1ï¼šé‡æ„ EnemySystem

**é—®é¢˜æè¿°**ï¼š
- `EnemySystem.ts` åŒ…å«å·¨å¤§çš„ `switch` è¯­å¥
- è¿åå¼€é—­åŸåˆ™
- æ–‡ä»¶è†¨èƒ€

**è§£å†³æ–¹æ¡ˆ**ï¼šç­–ç•¥æ¨¡å¼ + AI æ³¨å†Œæœºåˆ¶

1. **å®šä¹‰ AI ç­–ç•¥æ¥å£**
   ```typescript
   // src/engine/ai/AI.ts
   export interface AIStrategy {
     update(world: World, entityId: EntityId, dt: number): void;
     canExecute(world: World, entityId: EntityId): boolean;
   }
   
   export class AIRegistry {
     private static strategies: Map<string, AIStrategy> = new Map();
     
     static register(id: string, strategy: AIStrategy) {
       this.strategies.set(id, strategy);
     }
     
     static get(id: string): AIStrategy | undefined {
       return this.strategies.get(id);
     }
   }
   ```

2. **å®ç°å…·ä½“çš„ AI ç­–ç•¥**
   ```typescript
   // src/engine/ai/strategies/
   
   // BasicAI.ts
   export class BasicAI implements AIStrategy {
     update(world: World, entityId: EntityId, dt: number): void {
       // åŸºç¡€ AI é€»è¾‘
     }
     
     canExecute(world: World, entityId: EntityId): boolean {
       return true;
     }
   }
   
   // KamikazeAI.ts
   export class KamikazeAI implements AIStrategy {
     update(world: World, entityId: EntityId, dt: number): void {
       // è‡ªçˆ† AI é€»è¾‘
     }
     
     canExecute(world: World, entityId: EntityId): boolean {
       return true;
     }
   }
   
   // SniperAI.ts
   export class SniperAI implements AIStrategy {
     update(world: World, entityId: EntityId, dt: number): void {
       // ç‹™å‡» AI é€»è¾‘
     }
     
     canExecute(world: World, entityId: EntityId): boolean {
       return true;
     }
   }
   ```

3. **æ³¨å†Œ AI ç­–ç•¥**
   ```typescript
   // src/engine/ai/index.ts
   import { AIRegistry } from './AI';
   import { BasicAI } from './strategies/BasicAI';
   import { KamikazeAI } from './strategies/KamikazeAI';
   import { SniperAI } from './strategies/SniperAI';
   
   AIRegistry.register('basic', new BasicAI());
   AIRegistry.register('kamikaze', new KamikazeAI());
   AIRegistry.register('sniper', new SniperAI());
   ```

4. **é‡æ„ EnemySystem**
   ```typescript
   // src/engine/systems/EnemySystem.ts
   import { AIRegistry } from '@/engine/ai';
   
   export function EnemySystem(world: World, dt: number) {
     for (const [id, [enemyAI, tr, velocity]] of 
          view(world, [EnemyAI, Transform, Velocity])) {
       
       const strategy = AIRegistry.get(enemyAI.type);
       if (strategy && strategy.canExecute(world, id)) {
         strategy.update(world, id, dt);
       }
     }
   }
   ```

**é¢„è®¡æ—¶é—´**ï¼š7 å¤©  
**é£é™©ç­‰çº§**ï¼šä¸­

---

### ä»»åŠ¡ 4.2ï¼šBoss åˆå§‹åŒ–é‡æ„

**é—®é¢˜æè¿°**ï¼š
- `factory.ts` ä¸­çš„ `spawnBoss` å­˜åœ¨ç¡¬ç¼–ç é€»è¾‘
- è¿èƒŒæ•°æ®é©±åŠ¨åŸåˆ™

**è§£å†³æ–¹æ¡ˆ**ï¼šç§»å…¥è“å›¾å®šä¹‰

1. **æ‰©å±•è“å›¾ç±»å‹**
   ```typescript
   // src/engine/blueprints/bosses.ts
   export function createBossBlueprint(config: {
     base: Blueprint;
     ai: {
       type: string;
       phases: BossPhase[];
     };
     weapons: {
       primary: WeaponConfig;
       phases: Record<number, WeaponConfig>;
     };
   }): Blueprint {
     const blueprint: Blueprint = { ...config.base };
     
     // æ·»åŠ  BossAI ç»„ä»¶
     blueprint.BossAI = {
       type: config.ai.type,
       phases: config.ai.phases
     };
     
     // æ·»åŠ æ­¦å™¨ç»„ä»¶
     blueprint.Weapon = config.weapons.primary;
     
     return blueprint;
   }
   ```

2. **ç®€åŒ– spawnBoss**
   ```typescript
   // src/engine/factory.ts
   export function spawnBoss(world: World, bp: Blueprint, x: number, y: number, rot: number): EntityId {
     const id = spawnFromBlueprint(world, bp, x, y, rot, 'enemy');
     
     // ç§»é™¤ç¡¬ç¼–ç ï¼Œç”±è“å›¾å†³å®š
     const bossComps = world.entities.get(id);
     if (bossComps) {
       const bossTag = bossComps.find(c => c instanceof Components.BossTag);
       if (bossTag) {
         // ç¡®ä¿æœ‰å¿…è¦çš„ç»„ä»¶ï¼Œä½†ä¸ç¡¬ç¼–ç é»˜è®¤å€¼
         if (!bossComps.find(c => c instanceof Components.MoveIntent)) {
           addComponent(world, id, new Components.MoveIntent({ dx: 0, dy: 0, type: 'velocity' }));
         }
         if (!bossComps.find(c => c instanceof Components.FireIntent)) {
           addComponent(world, id, new Components.FireIntent({ firing: false }));
         }
       }
     }
     
     return id;
   }
   ```

**é¢„è®¡æ—¶é—´**ï¼š3 å¤©  
**é£é™©ç­‰çº§**ï¼šä½

---

### ä»»åŠ¡ 4.3ï¼šäº‹ä»¶ç³»ç»Ÿå¢å¼º

**é—®é¢˜æè¿°**ï¼š
- äº‹ä»¶æ¶ˆè´¹é¡ºåºä¾èµ–ç³»ç»Ÿæ‰§è¡Œé¡ºåº
- ç¼ºå°‘äº‹ä»¶ä¼˜å…ˆçº§
- éš¾ä»¥è¿½è¸ªäº‹ä»¶æµ

**è§£å†³æ–¹æ¡ˆ**ï¼šäº‹ä»¶ä¼˜å…ˆçº§ + è°ƒè¯•å·¥å…·

1. **æ·»åŠ äº‹ä»¶ä¼˜å…ˆçº§**
   ```typescript
   // src/engine/events.ts
   export interface Event {
     type: string;
     priority?: number;  // æ–°å¢ä¼˜å…ˆçº§
     timestamp?: number;
     source?: string;   // è°ƒè¯•ç”¨
   }
   
   export function pushEvent(w: World, event: Event) {
     if (event.timestamp === undefined) {
       event.timestamp = Date.now();
     }
     w.events.push(event);
   }
   
   // æŒ‰ä¼˜å…ˆçº§æ’åºäº‹ä»¶
   export function getSortedEvents(w: World): Event[] {
     return [...w.events].sort((a, b) => {
       const priorityA = a.priority ?? 0;
       const priorityB = b.priority ?? 0;
       if (priorityA !== priorityB) {
         return priorityB - priorityA;  // ä¼˜å…ˆçº§é«˜çš„å…ˆå¤„ç†
       }
       return a.timestamp! - b.timestamp!;
     });
   }
   ```

2. **å®ç°äº‹ä»¶è¿½è¸ªå™¨**
   ```typescript
   // src/engine/utils/EventTracker.ts
   export class EventTracker {
     private static enabled = false;
     private static events: { event: Event; frame: number; source: string }[] = [];
     
     static enable() {
       this.enabled = true;
     }
     
     static disable() {
       this.enabled = false;
     }
     
     static track(event: Event, frame: number, source: string) {
       if (this.enabled) {
         this.events.push({ event, frame, source });
         
         // åªä¿ç•™æœ€è¿‘ 1000 ä¸ªäº‹ä»¶
         if (this.events.length > 1000) {
           this.events.shift();
         }
       }
     }
     
     static getEvents() {
       return this.events;
     }
     
     static clear() {
       this.events = [];
     }
   }
   ```

3. **æ·»åŠ äº‹ä»¶å¯è§†åŒ–å·¥å…·**
   ```typescript
   // src/engine/debug/EventVisualizer.tsx
   import React from 'react';
   import { EventTracker } from '@/engine/utils/EventTracker';
   
   export function EventVisualizer() {
     const [events, setEvents] = React.useState(EventTracker.getEvents());
     
     React.useEffect(() => {
       const interval = setInterval(() => {
         setEvents(EventTracker.getEvents());
       }, 100);
       return () => clearInterval(interval);
     }, []);
     
     return (
       <div className="event-visualizer">
         <h3>Event Tracker</h3>
         <ul>
           {events.map((e, i) => (
             <li key={i}>
               <strong>{e.event.type}</strong>
               <span className="source">{e.source}</span>
               <span className="frame">Frame {e.frame}</span>
             </li>
           ))}
         </ul>
       </div>
     );
   }
   ```

**é¢„è®¡æ—¶é—´**ï¼š4 å¤©  
**é£é™©ç­‰çº§**ï¼šä½

---

### ä»»åŠ¡ 4.4ï¼šé…ç½®ç³»ç»Ÿå¢å¼º

**é—®é¢˜æè¿°**ï¼š
- ç¼ºå°‘é…ç½®éªŒè¯
- é…ç½®é”™è¯¯åœ¨è¿è¡Œæ—¶æ‰å‘ç°
- æ— å¯è§†åŒ–ç¼–è¾‘å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼šSchema éªŒè¯ + ç¼–è¾‘å™¨

1. **å®šä¹‰é…ç½® Schema**
   ```typescript
   // src/engine/configs/schemas/weaponSchema.ts
   import { z } from 'zod';
   
   export const WeaponSchema = z.object({
     id: z.string(),
     name: z.string(),
     description: z.string(),
     cooldown: z.number().min(100).max(5000),
     damage: z.number().min(1).max(1000),
     bulletCount: z.number().min(1).max(10),
     spread: z.number().min(0).max(360),
     pattern: z.enum(['straight', 'spread', 'spiral']),
     level: z.number().min(1).max(10),
     cost: z.number().min(0),
   });
   
   export type WeaponConfig = z.infer<typeof WeaponSchema>;
   ```

2. **å®ç°é…ç½®éªŒè¯**
   ```typescript
   // src/engine/utils/ConfigValidator.ts
   import { WeaponSchema } from '@/engine/configs/schemas/weaponSchema';
   
   export class ConfigValidator {
     static validateWeapon(config: unknown): WeaponConfig {
       try {
         return WeaponSchema.parse(config);
       } catch (error) {
         if (error instanceof z.ZodError) {
           console.error('Invalid weapon config:', error.errors);
           throw new Error('Weapon config validation failed');
         }
         throw error;
       }
     }
     
     static validateAll(configs: { [key: string]: unknown }) {
       const results: { valid: boolean; errors: string[] } = { valid: true, errors: [] };
       
       for (const [key, config] of Object.entries(configs)) {
         try {
           this.validateWeapon(config);
         } catch (error) {
           results.valid = false;
           results.errors.push(`${key}: ${error}`);
         }
       }
       
       return results;
     }
   }
   ```

3. **æ„å»ºæ—¶éªŒè¯**
   ```typescript
   // scripts/validate-configs.ts
   import { ConfigValidator } from '@/engine/utils/ConfigValidator';
   import { WEAPONS } from '@/engine/configs/gallery/weapons';
   
   const results = ConfigValidator.validateAll(WEAPONS);
   
   if (!results.valid) {
     console.error('Config validation failed:');
     results.errors.forEach(err => console.error(`  - ${err}`));
     process.exit(1);
   } else {
     console.log('All configs are valid!');
   }
   ```

4. **å¯è§†åŒ–é…ç½®ç¼–è¾‘å™¨**
   ```typescript
   // src/tools/ConfigEditor.tsx
   import React, { useState } from 'react';
   import { WEAPONS } from '@/engine/configs/gallery/weapons';
   
   export function ConfigEditor() {
     const [config, setConfig] = useState(WEAPONS);
     const [selectedWeapon, setSelectedWeapon] = useState<string | null>(null);
     
     const handleSave = () => {
       // ä¿å­˜é…ç½®
       localStorage.setItem('weapons-config', JSON.stringify(config));
     };
     
     return (
       <div className="config-editor">
         <div className="sidebar">
           <h3>Weapons</h3>
           <ul>
             {Object.keys(config).map(id => (
               <li 
                 key={id}
                 onClick={() => setSelectedWeapon(id)}
                 className={selectedWeapon === id ? 'selected' : ''}
               >
                 {config[id].name}
               </li>
             ))}
           </ul>
         </div>
         
         <div className="editor">
           {selectedWeapon && (
             <WeaponEditor 
               weapon={config[selectedWeapon]} 
               onChange={(updates) => {
                 setConfig({
                   ...config,
                   [selectedWeapon]: { ...config[selectedWeapon], ...updates }
                 });
               }}
             />
           )}
         </div>
         
         <button onClick={handleSave}>Save</button>
       </div>
     );
   }
   ```

**é¢„è®¡æ—¶é—´**ï¼š7 å¤©  
**é£é™©ç­‰çº§**ï¼šä¸­

---

### ç¬¬ä¸‰é˜¶æ®µæ€»ç»“

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | ä¼˜å…ˆçº§ | é£é™© |
|------|---------|--------|------|
| é‡æ„ EnemySystem | 7 å¤© | P2 | ä¸­ |
| Boss åˆå§‹åŒ–é‡æ„ | 3 å¤© | P2 | ä½ |
| äº‹ä»¶ç³»ç»Ÿå¢å¼º | 4 å¤© | P2 | ä½ |
| é…ç½®ç³»ç»Ÿå¢å¼º | 7 å¤© | P2 | ä¸­ |
| **æ€»è®¡** | **21 å¤© (~4 å‘¨)** | **P2** | **ä¸­** |

**äº¤ä»˜ç‰©**ï¼š
- AI ç³»ç»Ÿæ’ä»¶åŒ–
- æ•°æ®é©±åŠ¨ Boss é…ç½®
- äº‹ä»¶è¿½è¸ªå’Œè°ƒè¯•å·¥å…·
- é…ç½®éªŒè¯å’Œç¼–è¾‘å™¨

---

## äº”ã€ç¬¬å››é˜¶æ®µï¼šé•¿æœŸæ”¹è¿›ï¼ˆ3-6 ä¸ªæœˆï¼‰

### ç›®æ ‡
æˆ˜ç•¥æ€§åŠŸèƒ½æ‰©å±•ï¼Œæå‡æ¸¸æˆå“è´¨å’Œå¼€å‘æ•ˆç‡ã€‚

### ä»»åŠ¡ 5.1ï¼šAI ç³»ç»Ÿå¢å¼º

**å®ç°ç›®æ ‡**ï¼š
- è¡Œä¸ºæ ‘æ¶æ„
- çŠ¶æ€æœº
- æ›´å¤æ‚çš„ AI è¡Œä¸º

**å®æ–½æ­¥éª¤**ï¼š
1. è®¾è®¡è¡Œä¸ºæ ‘èŠ‚ç‚¹ç±»å‹
2. å®ç°è¡Œä¸ºæ ‘ç¼–è¾‘å™¨
3. é‡æ„ç°æœ‰ AI ä¸ºè¡Œä¸ºæ ‘
4. æ·»åŠ æ›´å¤š AI è¡Œä¸º

**é¢„è®¡æ—¶é—´**ï¼š3-4 å‘¨

---

### ä»»åŠ¡ 5.2ï¼šç½‘ç»œå¤šäººæ¸¸æˆ

**å®ç°ç›®æ ‡**ï¼š
- å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„
- å®æ—¶åŒæ­¥
- å»¶è¿Ÿè¡¥å¿

**å®æ–½æ­¥éª¤**ï¼š
1. è®¾è®¡ç½‘ç»œåè®®
2. å®ç°æœåŠ¡å™¨
3. å®¢æˆ·ç«¯åŒæ­¥
4. å»¶è¿Ÿä¼˜åŒ–

**é¢„è®¡æ—¶é—´**ï¼š6-8 å‘¨

---

### ä»»åŠ¡ 5.3ï¼šå…³å¡ç¼–è¾‘å™¨

**å®ç°ç›®æ ‡**ï¼š
- å¯è§†åŒ–å…³å¡è®¾è®¡
- æ‹–æ‹½å¼ç¼–è¾‘
- å®æ—¶é¢„è§ˆ

**å®æ–½æ­¥éª¤**ï¼š
1. è®¾è®¡ç¼–è¾‘å™¨ UI
2. å®ç°å…³å¡åºåˆ—åŒ–
3. å®ç°æ’¤é”€/é‡åš
4. æ·»åŠ æ¨¡æ¿åº“

**é¢„è®¡æ—¶é—´**ï¼š4-6 å‘¨

---

### ä»»åŠ¡ 5.4ï¼šæ€§èƒ½ç›‘æ§ç³»ç»Ÿ

**å®ç°ç›®æ ‡**ï¼š
- å®æ—¶ FPS ç›‘æ§
- å†…å­˜ä½¿ç”¨ç›‘æ§
- æ€§èƒ½ç“¶é¢ˆåˆ†æ

**å®æ–½æ­¥éª¤**ï¼š
1. å®ç°æ€§èƒ½æ•°æ®æ”¶é›†
2. å¯è§†åŒ–ä»ªè¡¨ç›˜
3. æ€§èƒ½æŠ¥å‘Šç”Ÿæˆ
4. ä¼˜åŒ–å»ºè®®ç³»ç»Ÿ

**é¢„è®¡æ—¶é—´**ï¼š2-3 å‘¨

---

### ç¬¬å››é˜¶æ®µæ€»ç»“

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | ä¼˜å…ˆçº§ | é£é™© |
|------|---------|--------|------|
| AI ç³»ç»Ÿå¢å¼º | 3-4 å‘¨ | P3 | é«˜ |
| ç½‘ç»œå¤šäººæ¸¸æˆ | 6-8 å‘¨ | P3 | é«˜ |
| å…³å¡ç¼–è¾‘å™¨ | 4-6 å‘¨ | P3 | ä¸­ |
| æ€§èƒ½ç›‘æ§ç³»ç»Ÿ | 2-3 å‘¨ | P3 | ä½ |
| **æ€»è®¡** | **15-21 å‘¨** | **P3** | **ä¸­** |

---

## å…­ã€æµ‹è¯•ä¸éƒ¨ç½²

### æµ‹è¯•ç­–ç•¥

#### 6.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•æ¡†æ¶**ï¼šJest + ts-jest

**æµ‹è¯•è¦†ç›–ç›®æ ‡**ï¼š
- ç»„ä»¶ï¼š90%
- ç³»ç»Ÿï¼š80%
- å·¥å…·å‡½æ•°ï¼š95%

**ç¤ºä¾‹æµ‹è¯•**ï¼š
```typescript
// src/engine/utils/Quadtree.test.ts
import { Quadtree } from './Quadtree';

describe('Quadtree', () => {
  it('should insert points', () => {
    const quadtree = new Quadtree({ x: 0, y: 0, w: 100, h: 100 }, 4);
    expect(quadtree.insert({ x: 10, y: 10, entityId: 1 })).toBe(true);
  });
  
  it('should query points in range', () => {
    const quadtree = new Quadtree({ x: 0, y: 0, w: 100, h: 100 }, 4);
    quadtree.insert({ x: 10, y: 10, entityId: 1 });
    quadtree.insert({ x: 90, y: 90, entityId: 2 });
    
    const results = quadtree.query({ x: 0, y: 0, w: 50, h: 50 });
    expect(results.length).toBe(1);
    expect(results[0].entityId).toBe(1);
  });
});
```

#### 6.2 é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š
- å®Œæ•´æ¸¸æˆæµç¨‹
- å…³å¡åˆ‡æ¢
- Boss æˆ˜
- è¿å‡»ç³»ç»Ÿ

**æµ‹è¯•å·¥å…·**ï¼š
- Playwright (E2E)
- Puppeteer (è‡ªåŠ¨åŒ–æµ‹è¯•)

#### 6.3 æ€§èƒ½æµ‹è¯•

**æµ‹è¯•å·¥å…·**ï¼š
- Chrome DevTools Performance
- Lighthouse
- WebPageTest

**æµ‹è¯•æŒ‡æ ‡**ï¼š
- FPS: >60
- é¦–æ¬¡æ¸²æŸ“: <1s
- å†…å­˜ä½¿ç”¨: <500MB

---

### éƒ¨ç½²ç­–ç•¥

#### 6.1 CI/CD æµç¨‹

```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm test
      - run: npm run build
  
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
```

#### 6.2 ç¯å¢ƒé…ç½®

**å¼€å‘ç¯å¢ƒ**ï¼š
- æœ¬åœ°å¼€å‘æœåŠ¡å™¨
- çƒ­é‡è½½
- è¯¦ç»†æ—¥å¿—

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
- CDN åŠ é€Ÿ
- å‹ç¼©ä¼˜åŒ–
- æ€§èƒ½ç›‘æ§

---

## ä¸ƒã€å›¢é˜Ÿåä½œ

### 7.1 ä»£ç è§„èŒƒ

**é£æ ¼æŒ‡å—**ï¼š
- ESLint + Prettier
- Airbnb JavaScript Style Guide
- TypeScript æœ€ä½³å®è·µ

**æäº¤è§„èŒƒ**ï¼š
```bash
feat: add bomb system
fix: resolve collision detection bug
docs: update API documentation
refactor: optimize view queries
test: add unit tests for Quadtree
```

### 7.2 åˆ†æ”¯ç­–ç•¥

**Git Flow**ï¼š
- `main`: ç”Ÿäº§åˆ†æ”¯
- `develop`: å¼€å‘åˆ†æ”¯
- `feature/*`: åŠŸèƒ½åˆ†æ”¯
- `bugfix/*`: ä¿®å¤åˆ†æ”¯
- `hotfix/*`: ç´§æ€¥ä¿®å¤

**åˆ†æ”¯å‘½å**ï¼š
```
feature/bomb-system
feature/quadtree-optimization
bugfix/collision-detection
hotfix/crash-issue
```

### 7.3 ä»£ç å®¡æŸ¥

**å®¡æŸ¥æ¸…å•**ï¼š
- [ ] ä»£ç ç¬¦åˆè§„èŒƒ
- [ ] æµ‹è¯•è¦†ç›–å……åˆ†
- [ ] æ–‡æ¡£æ›´æ–°å®Œæ•´
- [ ] æ€§èƒ½å½±å“è¯„ä¼°
- [ ] å®‰å…¨é—®é¢˜æ£€æŸ¥

**å®¡æŸ¥å·¥å…·**ï¼š
- GitHub Pull Requests
- CodeClimate
- SonarQube

---

## å…«ã€é£é™©ç®¡ç†

### é£é™©çŸ©é˜µ

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|---------|
| æ€§èƒ½ä¼˜åŒ–å¤±è´¥ | ä¸­ | é«˜ | åˆ†é˜¶æ®µä¼˜åŒ–ï¼Œå……åˆ†æµ‹è¯• |
| æ¶æ„é‡æ„å¯¼è‡´ Bug | é«˜ | ä¸­ | å®Œæ•´çš„æµ‹è¯•è¦†ç›– |
| ç¬¬ä¸‰æ–¹åº“æ›´æ–° | ä½ | ä¸­ | é”å®šç‰ˆæœ¬ï¼Œå®šæœŸè¯„ä¼° |
| å›¢é˜Ÿæˆå‘˜å˜åŠ¨ | ä¸­ | ä¸­ | çŸ¥è¯†æ–‡æ¡£åŒ–ï¼Œä»£ç å¯è¯»æ€§ |

### åº”æ€¥é¢„æ¡ˆ

**æ€§èƒ½å›é€€**ï¼š
- ä¿ç•™ä¼˜åŒ–å‰çš„ä»£ç 
- ä½¿ç”¨åŠŸèƒ½å¼€å…³æ§åˆ¶
- ç°åº¦å‘å¸ƒ

**Bug ä¿®å¤**ï¼š
- Hotfix æµç¨‹
- ç´§æ€¥å‘å¸ƒæµç¨‹
- å›æ»šæœºåˆ¶

---

## ä¹ã€æ€»ç»“

æœ¬å®æ–½è®¡åˆ’åŸºäºå¯¹éœ“ç”µæˆ˜è®°ä»£ç åº“çš„æ·±å…¥åˆ†æï¼Œæä¾›äº†ä¸€ä¸ªæ¸…æ™°ã€å¯æ‰§è¡Œçš„æ”¹è¿›è·¯çº¿å›¾ã€‚

### å…³é”®æˆæœ

1. **ç¬¬ä¸€é˜¶æ®µï¼ˆ2 å‘¨ï¼‰**ï¼šå®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼Œæ¸¸æˆå¯ç©
2. **ç¬¬äºŒé˜¶æ®µï¼ˆ3 å‘¨ï¼‰**ï¼šæ€§èƒ½ä¼˜åŒ–ï¼Œç¨³å®š 60 FPS
3. **ç¬¬ä¸‰é˜¶æ®µï¼ˆ2 ä¸ªæœˆï¼‰**ï¼šæ¶æ„é‡æ„ï¼Œæå‡å¯ç»´æŠ¤æ€§
4. **ç¬¬å››é˜¶æ®µï¼ˆ6 ä¸ªæœˆï¼‰**ï¼šæˆ˜ç•¥åŠŸèƒ½æ‰©å±•

### æˆåŠŸæ ‡å‡†

- âœ… æ‰€æœ‰ P0 ä»»åŠ¡å®Œæˆ
- âœ… æ€§èƒ½æå‡ 10 å€ä»¥ä¸Š
- âœ… ä»£ç è´¨é‡æ˜¾è‘—æå‡
- âœ… å¼€å‘æ•ˆç‡æé«˜ 30%

### åç»­å±•æœ›

éšç€å®æ–½è®¡åˆ’çš„æ¨è¿›ï¼Œéœ“ç”µæˆ˜è®°å°†æˆä¸ºä¸€ä¸ªé«˜æ€§èƒ½ã€å¯æ‰©å±•ã€æ˜“ç»´æŠ¤çš„ç°ä»£ç½‘é¡µæ¸¸æˆï¼Œä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å’Œå•†ä¸šåŒ–å¥ å®šåšå®çš„åŸºç¡€ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-14  
**ä¸‹æ¬¡æ›´æ–°**ï¼šæ ¹æ®å®æ–½è¿›åº¦è°ƒæ•´
